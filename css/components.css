/* merged components.css */

/* Buildable Units */
.buildable{
  flex:2;
  display:flex;
  flex-direction:column;
  min-height:0;
  transition:opacity 180ms ease;
}

.buildable.buildable-dim{ opacity:0.25; }

.build-slots{
	flex-direction:column;
  flex:1 1 90%;
  min-height:0;
  display:flex;
  gap:12px;
}

.build-slot{
  border:3px solid var(--khaki);
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  background:rgba(0,0,0,0.35);
  font-size:14px;
  text-transform:uppercase;
  padding:10px;
  box-sizing:border-box;
  overflow:hidden;
  user-select:none;
  cursor:default;
}

.build-slot-placeholder{
  color:rgba(230,226,211,0.55);
  font-style:italic;
}

.xp-panel{
  width:260px;
  padding:12px;
  border:2px solid var(--khaki);
  background:linear-gradient(145deg,#2b2b2b,#1a1a1a);
  display:flex;
  flex-direction:column;
  justify-content:center;
  box-sizing:border-box;
  align-items:center;
}

.xp-value{
  font-size:26px;
  text-align:center;
  margin-bottom:8px;
}

.xp-buttons{
  display:flex;
  gap:10px;
  justify-content:center;
}

/* CONTROLS */
.controls{
  display:flex;
  gap:24px;
  align-items:stretch;
  background:linear-gradient(145deg,#3a3f2b,#262a1d);
  border:2px solid var(--olive);
  padding:15px;
  margin-bottom:18px;
  box-sizing:border-box;
}

.left-controls{
  display:flex;
  flex-direction:row;
  flex: 1;
}

.commander-controls{
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:center;
  flex:4;
}

.carousel{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding:10px;
  align-items:center;
  border:2px solid rgba(182,168,117,0.25);
  background:rgba(0,0,0,0.18);
  box-sizing:border-box;
}

.upgrade-tile{
  width:150px;
  height:320px;
  border:4px solid var(--khaki);
  background:rgba(0,0,0,0.4);
  padding:6px;
  box-sizing:border-box;
  display:flex;
  align-items:center;
  justify-content:center;
  flex:0 0 auto;
  overflow:hidden;
}

.upgrade-tile img{
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
  background:#111;
}

.locked{
  opacity:0.35;
  filter:grayscale(1);
  cursor:not-allowed;
}

.locked::after{
  content:'INSUFFICIENT XP';
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  font-weight:bold;
  background:rgba(139,43,43,0.6);
  border:2px solid var(--danger);
  color:#fff;
  text-align:center;
}

.xp-denied{ animation:shake .35s; }

@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-6px)}
  50%{transform:translateX(6px)}
  75%{transform:translateX(-6px)}
  100%{transform:translateX(0)}
}

.reroll-danger{ animation:pulse 0.6s infinite alternate; }

@keyframes pulse{ from{ box-shadow:none; } to{ box-shadow:0 0 12px var(--danger); } }

.sheet{
  position:fixed;
  inset:0;
  display:none;
  background:rgba(0,0,0,0.75);
  z-index:3000;
}

.sheet[aria-hidden="false"]{ display:block; }

.sheet-inner{
  position:absolute;
  left:0; right:0; bottom:0;
  background:#141414;
  border-top:3px solid var(--olive);
  border-radius:18px 18px 0 0;
  max-height:85vh;
  display:flex;
  flex-direction:column;
}

.sheet-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 14px;
  border-bottom:1px solid rgba(182,168,117,0.25);
}

.sheet-title{
  font-size:16px;
  letter-spacing:1px;
  text-transform:uppercase;
}

.sheet-close{
  all:unset;
  cursor:pointer;
  display:grid;
  place-items:center;
  width:40px;
  height:40px;
  color:#e04b4b; /* red X */
  font-size:24px;
  line-height:1;
  background:transparent;
}

.sheet-close:hover{
  filter:brightness(1.15);
}

.sheet-close:focus-visible{
  outline:2px solid rgba(224,75,75,0.8);
  outline-offset:2px;
}
.sheet-body{
  padding:12px 14px 18px;
  overflow:auto;
}

.sheet-body img{
  width:100%;
  height:auto;
  max-height:70vh;
  object-fit:contain;
  display:block;
  background:#0f0f0f;
  border:2px solid var(--olive);
  padding:10px;
  box-sizing:border-box;
}

.callin-badge{
  position:absolute;
  top:8px;
  right:8px;
  font-size:11px;
  padding:2px 6px;
  border:1px solid var(--khaki);
  background:rgba(0,0,0,0.65);
  text-transform:uppercase;
  letter-spacing:1px;
}

.upgrade-card,
.upgrade-tile{
  position:relative;
}

@keyframes hintPulse{
	  0%{ transform:scale(0.9); opacity:0; }
	  40%{ transform:scale(1.1); opacity:1; }
	  100%{ transform:scale(1); }
	}

.carousel-shell{
  position:relative;
}

.carousel-arrow{
  position:absolute;
  top:47%;
  transform:translateY(-50%);
  font-size:42px;
  line-height:1;
  padding:10px;
  color:rgba(230,226,211,0.85);
  cursor:pointer;
  user-select:none;
  pointer-events:auto;
  z-index:5;
  transition:opacity 200ms ease, transform 200ms ease;
}

.carousel-arrow.left{
  left: 0px;
  padding: 10px 0px 10px 0px;
}

.carousel-arrow.right{
  right: 0px;
  padding: 10px 0px 0px 10px
}

.carousel-arrow.disabled{
  opacity:0;
  pointer-events:none;
  transform:translateY(-50%) scale(0.85);
}

.ai-card-thumb{
  width: 72px;
  height: auto;

  cursor: pointer;
  user-select: none;

  border: 2px solid var(--khaki);
  background: rgba(0,0,0,0.4);

  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.ai-card-thumb:hover{
  transform: scale(1.05);
  box-shadow: 0 0 12px rgba(0,0,0,0.6);
}

.ai-card-thumb:active{
  transform: scale(0.98);
}

.icon-btn{
  width: 40px;
  height: 40px;

  display: flex;
  align-items: center;
  justify-content: center;

  font-size: 22px;
  font-weight: 700;

  color: var(--khaki);
  background: transparent;
  border: none;

  cursor: pointer;
  user-select: none;

  transition: transform 0.15s ease, color 0.15s ease;
}

.icon-btn:hover{
  color: #ffd966;
  transform: rotate(90deg);
}

.icon-btn:active{
  transform: rotate(180deg) scale(0.95);
}

.icon-btn:focus{
  outline: none;
}

.refresh-btn:active{
  animation: refresh-spin 0.35s ease;
}

@keyframes refresh-spin{
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}

.ai-launchers{
  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:flex-start;
  justify-content: center;
  flex:1;
}
.ai-launchers.is-hidden{
  display:none !important;
}


.ai-card-stage{
  position:relative;
  display:inline-block; /* shrink-wrap to image width */
  max-width:100%;
}

.ai-card-stage > img{
  display:block;
  max-width:100%;
  height:70vh;
}

/* Transparent clickable overlays */
.ai-hotspot{
  position:absolute;
  border:0;
  background:transparent;
  padding:0;
  margin:0;
  cursor:pointer;
  /* helpful on mobile */
  touch-action:manipulation;
}


.ai-hotspot[data-ref="1"]{ left:  20.5vw; top:  14vh; width: 5vw; height: 11vh; }

.ai-hotspot[data-ref="2"]{ left:  24.25vw; top:  26vh; width: 5vw; height: 11vh; }

.ai-hotspot[data-ref="3"]{ left:  28vw; top:  39vh; width: 5vw; height: 11vh; }

.ai-hotspot[data-ref="4"]{ left:  31.75vw; top:  51vh; width: 5vw; height: 12vh; }


/* Commander tile */
.commander-tile{
  aspect-ratio: 150/320;
  border:4px solid var(--khaki);
  background:rgba(0,0,0,0.4);
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-size:16px;
  cursor:pointer;
  padding:10px;
  box-sizing:border-box;
  position:relative;
  overflow:hidden;
}

.commander-tile .plus{
  position:absolute;
  
  font-size:300px;
  line-height:1;
  opacity:0.3;
  pointer-events:none;
}

.commander-tile .label{
  padding:8px;
  line-height:1.1;
  user-select:none;
}

.commander-tile img{
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
}

/* Emphasis until commander selected */
.commander-emphasis{
  outline:2px dashed rgba(196,154,44,0.7);
  outline-offset:8px;
  box-shadow:0 0 18px rgba(196,154,44,0.35);
  animation:commanderPulse 1.2s ease-in-out infinite alternate;
}

@keyframes commanderPulse{
  from{ transform:translateY(0); box-shadow:0 0 12px rgba(196,154,44,0.15); }
  to{ transform:translateY(-2px); box-shadow:0 0 52px rgba(196,154,44,0.45); }
}

/* ================== COMMANDER MOBILE CAROUSEL ================== */
.cmd-carousel{
  display:none;
  width:100%;
  overflow:hidden;
  padding:4px 0 4px;
  box-sizing:border-box;
}

.cmd-track{
  display:flex;
  align-items:center;
  will-change:transform;
  touch-action:pan-y; /* allow vertical scroll; we handle horizontal swipe */
}

.cmd-card{
  width:min(66vw, 360px);
  aspect-ratio: 150 / 320; /* match your tile proportions */
  border:4px solid var(--khaki);
  background:rgba(0,0,0,0.35);
  overflow:hidden;
  position:relative;
  transform:scale(0.88);
  opacity:0.45;
  filter:grayscale(0.25);
  transition:transform 260ms ease, opacity 260ms ease, filter 260ms ease;
  display:flex;
  align-items:center;
  justify-content:center;
}

.cmd-card img{
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
}

/* Focused (center) */
.cmd-card.is-active{
  transform:scale(1);
  opacity:1;
  filter:none;
  box-shadow:0 0 18px rgba(196,154,44,0.22);
}

/* Slightly visible peek of neighbors */


/* Smooth snapping feel */
.cmd-track.is-animating{
  transition:transform 280ms ease;
}

/* Modal shared */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  justify-content:center;
  align-items:center;
  z-index:1000;
}

.modal-content{
  background:#1e1e1e;
  border:3px solid var(--olive);
  padding:0;
  width:900px;
  max-height:90vh;
  position:relative;
  display:flex;
  flex-direction:column;
}

.modal-header{
  flex:0 0 auto;
  padding:14px 16px;
  border-bottom:2px solid rgba(182,168,117,0.25);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  position:sticky;
  top:0;
  background:#1e1e1e;
  z-index:2;
}

.modal-body{
  flex:1 1 auto;
  padding:10px;
  overflow-y:auto;
  min-height: 0;
  display: flex;
  flex-direction: column;
}

#pickerModal {
  height:100%;
  min-height:0;
  padding: 6px 0;        /* keep some padding */
}

#pickerModal .modal-body{
  flex:1 1 auto;
  min-height:0;          /* critical: allows children to shrink */
  overflow:hidden;       /* prevents bottom clipping/scroll fights */
  padding: 10px 12px;    /* keep your padding */
}

.modal-close{
  cursor:pointer;
  font-size:34px;
  color:var(--danger);
  user-select:none;
  line-height:1;
}

.modal-grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:16px;
  margin-top:12px;
}

.modal-header h3{
	text-align:left;
}

#pickerGrid{
  display:grid;
  gap:12px;
  grid-template-columns: repeat(3, minmax(0, 1fr));
}

#pickerGrid.grid-5{
  grid-template-columns: repeat(5, minmax(0, 1fr));
}

#pickerGrid.grid-4{
  grid-template-columns: repeat(4, minmax(0, 1fr));
}

#pickerGrid.grid-3{
  grid-template-columns: repeat(3, minmax(0, 1fr));
}

#pickerGrid.grid-2{
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

#pickerGrid.grid-1{
  grid-template-columns: repeat(1, minmax(0, 1fr));
}

.picker-carousel{
  width:100%;
  overflow:hidden;
  padding:6px 0 12px;
  box-sizing:border-box;
  flex: 1 1 auto;
  min-height: 0;
  display: flex;
}

#pickerCarousel{
	flex: 1 1 auto;
	min-height: 0;
	height:100%;
}


.carousel-viewport {
  flex: 1 1 auto;
  min-height: 0;
  overflow: hidden;
}



.picker-track{
  display:flex;
  align-items:center;
  box-sizing:border-box;
  padding: 0 10vw;  /* peek window */
  gap: 12px;
  will-change:transform;
  touch-action:pan-y;
}

.picker-slide{
  padding: 6px 0;
  display:flex;
  justify-content:center;
  align-items:center;
  box-sizing:border-box;
  flex: 0 0 100%;
  max-height: 100%;
}


#pickerArrowLeft { display:none;}
#pickerArrowRight { display:none;}

.picker-card{
  width:90%;
  max-height:100%;
  border:4px solid var(--khaki);
  background:rgba(0,0,0,0.35);
  overflow:hidden;
  position:relative;
  transform:scale(0.88);
  opacity:0.45;
  filter:grayscale(0.25);
  transition:transform 260ms ease, opacity 260ms ease, filter 260ms ease;
  display:flex;
  align-items:center;
  justify-content:center;
  box-sizing:border-box;
  cursor:pointer;
}

.picker-card.is-active{
  transform:scale(1);
  opacity:1;
  filter:none;
  box-shadow:0 0 18px rgba(196,154,44,0.22);
}

.picker-track.is-animating{ transition:transform 280ms ease; }


.picker-card:not(.is-active){ transform:scale(.94); opacity:.55; }

.picker-card img{
  width: auto;
  max-width: 100%;
  height:auto;
  max-height: 100%;
  object-fit:contain;
  display:block;
  background:#111;
  pointer-events:none;
  user-select:none;
  -webkit-user-drag:none;
  
}

/* Rarity border overrides */
.picker-card.common{ border-color:var(--common); }

.picker-card.veteran{ border-color:var(--veteran); }

.picker-card.elite{ border-color:var(--elite); border-width:8px; }

.picker-card.legendary{ border-color:var(--legendary); border-width:8px; }

/* ================== HOVER POPUP ================== */

.hover-popup{
  position:fixed;
  display:none;
  z-index:2000;
  pointer-events:none;
  background:rgba(12,12,12,0.92);
  border:2px solid var(--khaki);
  box-shadow:0 0 18px rgba(0,0,0,0.65);
  padding:10px;
  max-width:520px;
}

.hover-popup img{
  width:100%;
  height:auto;
  max-height:70vh;      /* safety clamp so it never gets absurdly tall */
  object-fit:contain;
  display:block;
  background:#111;
  border:2px solid var(--olive);
  padding:10px;
  box-sizing:border-box;
}

.hover-popup .hover-title{
  margin-bottom:10px;
  font-size:16px;
  letter-spacing:1px;
  text-transform:uppercase;
  opacity:0.9;
  text-align:center;
}

.image-viewer-body{
  display:flex;
  justify-content:center;
  align-items:center;
}

.image-viewer-wrap{
  position:relative;
  max-width:100%;
  max-height:70vh;
}

#imageViewerImg{
  display:block;
  max-width:100%;
  max-height:70vh;
  object-fit:contain;
}

#imageViewerCallInBadge{
  position:absolute;
  top:10px;
  right:10px;
  left:auto;
  transform:scale(1.5);
  transform-origin:top right;
  z-index:3;
}

/* ================== UNIT SWAP MODAL ================== */
.unit-option-card{
  cursor:pointer;
}

.unit-option-card img{
  max-width:100%;
  height:auto;
  max-height:440px;
  object-fit:contain;
  border:4px solid var(--khaki);
  background:rgba(0,0,0,0.4);
  box-sizing:border-box;
  padding:8px;
  display:block;
  margin:0 auto;
}

.unit-subtitle{
  margin-top:8px;
  font-size:12px;
  letter-spacing:1px;
  text-transform:uppercase;
  opacity:0.85;
  text-align:center;
}

/* ================== UNIT SWAP MOBILE CAROUSEL ================== */
.us-carousel{
  width:100%;
  overflow:hidden;
  padding:6px 0 12px;
  box-sizing:border-box;
}

.us-track{
  display:flex;
  align-items:center;
  box-sizing:border-box;
  padding: 0 10vw;  /* peek window */
  gap: 12px;
  will-change:transform;
  touch-action:pan-y;
}

.us-slide{
  flex: 0 0 72vw;
  padding: 6px 0;
  display:flex;
  justify-content:center;
  align-items:center;
  box-sizing:border-box;
}

.us-card{
  width:100%;
  aspect-ratio: 150 / 320;
  border:4px solid var(--khaki);
  background:rgba(0,0,0,0.35);
  overflow:hidden;
  position:relative;
  transform:scale(0.88);
  opacity:0.45;
  filter:grayscale(0.25);
  transition:transform 260ms ease, opacity 260ms ease, filter 260ms ease;
  display:flex;
  align-items:center;
  justify-content:center;
}

.us-card img{
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
  pointer-events:none;
  user-select:none;
  -webkit-user-drag:none;
}

.us-card.is-active{
  transform:scale(1);
  opacity:1;
  filter:none;
  box-shadow:0 0 18px rgba(196,154,44,0.22);
}

/* Upgrades */
.upgrades-hidden{ display:none; }
.upgrade-card.elite img{ border-width:6px; }
.upgrade-card.legendary img{ border-width:8px; }

/* Carousel tiles: border is on the TILE container */
.upgrade-tile.elite{
  border-width:6px;
  border-color:var(--elite);
}

.upgrade-tile.legendary{
  border-width:8px;
  border-color:var(--legendary);
  box-shadow:0 0 16px rgba(196,154,44,0.25);
}

/* Optional: make common/veteran match your existing khaki framing */
.upgrade-tile.common,
.upgrade-tile.veteran{
  border-color:var(--khaki);
}

/* ================== LEGENDARY REVEAL EFFECT ================== */
/* Apply class .legendary-reveal to a legendary card to animate a veil lifting */
.upgrade-card.legendary.legendary-reveal{
  overflow:hidden; /* ensure overlay clips */
}

.upgrade-card.legendary.legendary-reveal::before{
  content:'';
  position:absolute;
  inset:0;
  background:linear-gradient(
	180deg,
	rgba(0,0,0,0.92) 0%,
	rgba(0,0,0,0.75) 55%,
	rgba(0,0,0,0.0) 100%
  );
  transform:translateY(0);
  animation:legendaryReveal 1.8s ease-out forwards;
  pointer-events:none;
}

.upgrade-card.legendary.legendary-reveal::after{
  content:'';
  position:absolute;
  inset:-20%;
  background:radial-gradient(circle, rgba(196,154,44,0.22) 0%, rgba(196,154,44,0.0) 60%);
  opacity:0;
  animation:legendaryGlimmer 1.8s ease-out forwards;
  pointer-events:none;
}

@keyframes legendaryReveal{
  0%{ transform:translateY(0); }
  100%{ transform:translateY(-110%); }
}

@keyframes legendaryGlimmer{
  0%{ opacity:0; transform:scale(0.95); }
  35%{ opacity:1; }
  100%{ opacity:0; transform:scale(1.05); }
}

.add-upgrade{
  width:150px;
  height:320px;
  border:4px solid var(--khaki);
  background:rgba(0,0,0,0.4);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:64px;
  cursor:pointer;
  box-sizing:border-box;
  flex:0 0 auto;
  user-select:none;
}

.upgrade-card{
  cursor:pointer;
  padding:10px;
  border:2px solid transparent;
  background:rgba(0,0,0,0.25);
  position:relative;
  box-sizing:border-box;
}

.upgrade-card img{
  max-width:100%;
  height:auto;
  max-height:440px;
  object-fit:contain;
  border:4px solid;
  background:rgba(0,0,0,0.4);
  box-sizing:border-box;
  padding:8px;
  display:block;
  margin:0 auto;
}

.upgrade-card.common img{ border-color:var(--common); }

.upgrade-card.veteran img{ border-color:var(--veteran); }

.upgrade-card.elite img{ border-color:var(--elite); }

.upgrade-card.legendary img{ border-color:var(--legendary); }

.rarity-label{
  position:absolute;
  bottom:8px;
  right:8px;
  padding:2px 6px;
  font-size:12px;
  background:rgba(0,0,0,0.7);
  border:1px solid var(--khaki);
  text-transform:uppercase;
}

.xp-cheat{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:13px;
  opacity:.4;
  user-select:none;
}
.xp-cheat input{ transform: scale(1.1); 
}

/* When cheat is enabled, collapse XP readout/buttons but keep checkbox visible */
.xp-panel.xp-minimized .xp-value,
.xp-panel.xp-minimized .xp-buttons{
  display: none !important;
}

